<!DOCTYPE html>
<html>
<head>
	<title>Create Link</title>
</head>
<body>
	<form action="#" onsubmit="createLink();return false">
		<input type="text" id="resource-input" name="resource" placeholder="Enter a URL" oninput="inputChange()" autocomplete="off">
		<br>
		<input type="submit" id="submit-button" value="Submit" disabled="true">
	</form>
</body>
<script>
const resourceInput = document.querySelector("#resource-input");
const submitButton = document.querySelector("#submit-button");

function createLink() {
	try {
		const value = resourceInput.value;
		fetch("/sk-create?resource="+btoa(value))
			.then(response => response.text()).then(text => {
				const split = text.split(" ");
				window.location.href = split[0] + "?key=" + split[1];
			});
	} catch(err) {
		console.error(err);
	}
}

function inputChange() {
	allowSubmit();
	const value = resourceInput.value;
	if (value.length == 0) {
		preventSubmit();
		return;
	}
	var u;
	try {
		u = new URL(value);
	} catch(err) {
		preventSubmit();
		return;
	}
}

function preventSubmit() {
	submitButton.disabled = true;
}

function allowSubmit() {
	submitButton.disabled = false;
}


</script>
</html>